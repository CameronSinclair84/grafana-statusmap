{"version":3,"sources":["../src/color_legend.js"],"names":["drawColorLegend","elem","colorScheme","rangeFrom","rangeTo","maxValue","minValue","legendElem","$","find","legend","d3","select","get","clearLegend","legendWidth","Math","floor","outerWidth","legendHeight","attr","rangeStep","LEGEND_STEP_WIDTH","widthFactor","valuesRange","range","colorScale","getColorScale","selectAll","data","enter","append","d","drawLegendValues","drawOpacityLegend","options","opacityScale","getOpacityScale","cardColor","style","drawDiscreteColorLegend","colorOptions","discreteHelper","thresholds","tooltips","_","map","tr","tooltip","valuesNumber","length","$heatmap","parent","graphWidth","textWidth","text","each","i","thisWidth","getBBox","width","push","remove","min","max","itemWidth","getDiscreteColor","drawDiscreteLegendValues","childNodes","legendValueScale","scaleLinear","domain","ticks","buildLegendTicks","xAxis","axisBottom","tickValues","tickSize","colorRect","posY","getSvgElemHeight","posX","getSvgElemX","call","thresholdValues","thresholdTooltips","value","tickFormat","t","v","undefined","drawSimpleColorLegend","drawSimpleOpacityLegend","legendOpacityScale","scalePow","exponent","empty","colorInterpolator","d3ScaleChromatic","colorScaleInverted","invert","contextSrv","user","lightTheme","start","end","scaleSequential","svgElem","x","baseVal","height","tickStepSize","tickStep","ticksNum","round","current","isValueCloseTo","sortBy","uniq","val","valueTo","step","diff","abs","angular","mod","module","directive","restrict","template","link","scope","attrs","ctrl","panel","render","events","on","color","mode","colorSchemes","show","isEmpty","cardsData","cards"],"mappings":"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","file":"color_legend.js","sourcesContent":["import angular from 'angular';\r\nimport _ from 'lodash';\r\nimport $ from 'jquery';\r\nimport d3 from 'd3';\r\nimport * as d3ScaleChromatic from './libs/d3-scale-chromatic/index';\r\nimport {contextSrv} from 'app/core/core';\r\nimport {tickStep} from 'app/core/utils/ticks';\r\n\r\nlet mod = angular.module('grafana.directives');\r\n\r\nconst LEGEND_STEP_WIDTH = 2;\r\n\r\n/**\r\n * Bigger color legend for opacity and spectrum modes editor.\r\n */\r\nmod.directive('optionsColorLegend', function() {\r\n  return {\r\n    restrict: 'E',\r\n    template: '<div class=\"status-heatmap-color-legend\"><svg width=\"16.8rem\" height=\"24px\"></svg></div>',\r\n    link: function(scope, elem, attrs) {\r\n      let ctrl = scope.ctrl;\r\n      let panel = scope.ctrl.panel;\r\n\r\n      render();\r\n\r\n      ctrl.events.on('render', function() {\r\n        render();\r\n      });\r\n\r\n      function render() {\r\n        let legendElem = $(elem).find('svg');\r\n        let legendWidth = Math.floor(legendElem.outerWidth());\r\n\r\n        if (panel.color.mode === 'spectrum') {\r\n          let colorScheme = _.find(ctrl.colorSchemes, {value: panel.color.colorScheme});\r\n          let colorScale = getColorScale(colorScheme, legendWidth);\r\n          drawSimpleColorLegend(elem, colorScale);\r\n        } else if (panel.color.mode === 'opacity') {\r\n          let colorOptions = panel.color;\r\n          drawSimpleOpacityLegend(elem, colorOptions);\r\n        }\r\n      }\r\n    }\r\n  };\r\n});\r\n\r\n/**\r\n * Graph legend with values.\r\n */\r\nmod.directive('statusHeatmapLegend', function() {\r\n  return {\r\n    restrict: 'E',\r\n    template: '<div class=\"status-heatmap-color-legend\"><svg width=\"100px\" height=\"6px\"></svg></div>',\r\n    link: function(scope, elem, attrs) {\r\n      let ctrl = scope.ctrl;\r\n      let panel = scope.ctrl.panel;\r\n\r\n      render();\r\n      ctrl.events.on('render', function() {\r\n        render();\r\n      });\r\n\r\n      function render() {\r\n        clearLegend(elem);\r\n        if (!ctrl.panel.legend.show) {\r\n          return \r\n        }\r\n        if (!_.isEmpty(ctrl.cardsData) && !_.isEmpty(ctrl.cardsData.cards)) {\r\n          let rangeFrom = ctrl.cardsData.minValue;\r\n          let rangeTo = ctrl.cardsData.maxValue;\r\n          let maxValue = panel.color.max || rangeTo;\r\n          let minValue = panel.color.min || rangeFrom;\r\n\r\n          if (panel.color.mode === 'spectrum') {\r\n            let colorScheme = _.find(ctrl.colorSchemes, {value: panel.color.colorScheme});\r\n            drawColorLegend(elem, colorScheme, rangeFrom, rangeTo, maxValue, minValue);\r\n          } else if (panel.color.mode === 'opacity') {\r\n            let colorOptions = panel.color;\r\n            drawOpacityLegend(elem, colorOptions, rangeFrom, rangeTo, maxValue, minValue);\r\n          } else if (panel.color.mode === 'discrete') {\r\n            let colorOptions = panel.color;\r\n            drawDiscreteColorLegend(elem, colorOptions, ctrl.discreteHelper);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  };\r\n});\r\n\r\nfunction drawColorLegend(elem, colorScheme, rangeFrom, rangeTo, maxValue, minValue) {\r\n  let legendElem = $(elem).find('svg');\r\n  let legend = d3.select(legendElem.get(0));\r\n  clearLegend(elem);\r\n\r\n  let legendWidth = Math.floor(legendElem.outerWidth()) - 30;  // narrow legendWidth by 30px to get space for first and last tick values\r\n  let legendHeight = legendElem.attr(\"height\");\r\n\r\n  let rangeStep = (rangeTo - rangeFrom) / (legendWidth/LEGEND_STEP_WIDTH);\r\n  // width in pixels in legend space of unit segment in range space\r\n  // rangeStep * witdhFactor == width in pixels of one rangeStep\r\n  let widthFactor = legendWidth / (rangeTo - rangeFrom);\r\n  let valuesRange = d3.range(rangeFrom, rangeTo, rangeStep);\r\n\r\n  let colorScale = getColorScale(colorScheme, maxValue, minValue);\r\n  legend.selectAll(\".status-heatmap-color-legend-rect\")\r\n    .data(valuesRange)\r\n    .enter().append(\"rect\")\r\n    // translate from range space into pixels\r\n    // and shift all rectangles to the right by 10\r\n    .attr(\"x\", d => d * widthFactor+10)\r\n    .attr(\"y\", 0)\r\n    // rectangles are slightly overlaped to prevent gaps\r\n    .attr(\"width\", LEGEND_STEP_WIDTH+1)\r\n    .attr(\"height\", legendHeight)\r\n    .attr(\"stroke-width\", 0)\r\n    .attr(\"fill\", d => colorScale(d));\r\n\r\n  drawLegendValues(elem, colorScale, rangeFrom, rangeTo, maxValue, minValue, legendWidth);\r\n}\r\n\r\nfunction drawOpacityLegend(elem, options, rangeFrom, rangeTo, maxValue, minValue) {\r\n  let legendElem = $(elem).find('svg');\r\n  let legend = d3.select(legendElem.get(0));\r\n  clearLegend(elem);\r\n\r\n  let legendWidth = Math.floor(legendElem.outerWidth()) - 30;  // narrow legendWidth by 30px to get space for first and last tick values\r\n  let legendHeight = legendElem.attr(\"height\");\r\n\r\n  let rangeStep = (rangeTo - rangeFrom) / (legendWidth/LEGEND_STEP_WIDTH);\r\n  // width in pixels in legend space of unit segment in range space\r\n  // rangeStep * witdhFactor == width in pixels of one rangeStep\r\n  let widthFactor = legendWidth / (rangeTo - rangeFrom);\r\n  let valuesRange = d3.range(rangeFrom, rangeTo, rangeStep);\r\n\r\n  let opacityScale = getOpacityScale(options, maxValue, minValue);\r\n  legend.selectAll(\".status-heatmap-opacity-legend-rect\")\r\n    .data(valuesRange)\r\n    .enter().append(\"rect\")\r\n    // translate from range space into pixels\r\n    // and shift all rectangles to the right by 10\r\n    .attr(\"x\", d => d * widthFactor+10)\r\n    .attr(\"y\", 0)\r\n    // rectangles are slightly overlaped to prevent gaps\r\n    .attr(\"width\", LEGEND_STEP_WIDTH+1)\r\n    .attr(\"height\", legendHeight)\r\n    .attr(\"stroke-width\", 0)\r\n    .attr(\"fill\", options.cardColor)\r\n    .style(\"opacity\", d => opacityScale(d));\r\n\r\n  drawLegendValues(elem, opacityScale, rangeFrom, rangeTo, maxValue, minValue, legendWidth);\r\n}\r\n\r\nfunction drawDiscreteColorLegend(elem, colorOptions, discreteHelper) {\r\n  let legendElem = $(elem).find('svg');\r\n  let legend = d3.select(legendElem.get(0));\r\n  clearLegend(elem);\r\n\r\n  let thresholds = colorOptions.thresholds;\r\n  let tooltips = _.map(thresholds, tr => tr.tooltip);\r\n  let valuesNumber = thresholds.length;\r\n\r\n  // graph width as a fallback\r\n  let $heatmap = $(elem).parent().parent().parent().find('.status-heatmap-panel');\r\n  let graphWidth  = $heatmap.find('svg').attr(\"width\");\r\n\r\n  // calculate max width of tooltip and use it as width for each item\r\n  let textWidth = [];\r\n  legend.selectAll(\".hidden-texts\")\r\n    .data(tooltips)\r\n    .enter().append(\"text\")\r\n    .attr(\"class\", \"axis tick hidden-texts\")\r\n    .attr(\"font-family\", \"sans-serif\")\r\n    .text(d => d)\r\n    .each(function(d,i) {\r\n      let thisWidth = this.getBBox().width;\r\n      textWidth.push(thisWidth);\r\n    });\r\n  legend.selectAll(\".hidden-texts\").remove();\r\n\r\n  let legendWidth = Math.floor(_.min([\r\n    graphWidth - 30,\r\n    (_.max(textWidth) + 3) * valuesNumber,\r\n  ]));\r\n  legendElem.attr(\"width\", legendWidth);\r\n\r\n  let legendHeight = legendElem.attr(\"height\");\r\n\r\n  let itemWidth  = Math.floor(legendWidth / valuesNumber);\r\n  let valuesRange = d3.range(valuesNumber); // from 0 to valuesNumber-1\r\n\r\n  legend.selectAll(\".status-heatmap-color-legend-rect\")\r\n    .data(valuesRange)\r\n    .enter().append(\"rect\")\r\n    .attr(\"x\", d => d*itemWidth)\r\n    .attr(\"y\", 0)\r\n    .attr(\"width\", itemWidth + 1) // Overlap rectangles to prevent gaps\r\n    .attr(\"height\", legendHeight)\r\n    .attr(\"stroke-width\", 0)\r\n    .attr(\"fill\", d => discreteHelper.getDiscreteColor(d));\r\n\r\n  drawDiscreteLegendValues(elem, colorOptions, legendWidth);\r\n}\r\n\r\n\r\nfunction drawLegendValues(elem, colorScale, rangeFrom, rangeTo, maxValue, minValue, legendWidth) {\r\n  let legendElem = $(elem).find('svg');\r\n  let legend = d3.select(legendElem.get(0));\r\n\r\n  if (legendWidth <= 0 || legendElem.get(0).childNodes.length === 0) {\r\n    return;\r\n  }\r\n\r\n  let legendValueScale = d3.scaleLinear()\r\n    .domain([0, rangeTo])\r\n    .range([0, legendWidth]);\r\n\r\n  let ticks = buildLegendTicks(0, rangeTo, maxValue, minValue);\r\n  let xAxis = d3.axisBottom(legendValueScale)\r\n    .tickValues(ticks)\r\n    .tickSize(2);\r\n\r\n  let colorRect = legendElem.find(\":first-child\");\r\n  let posY = getSvgElemHeight(legendElem) + 2;\r\n  let posX = getSvgElemX(colorRect);\r\n\r\n  d3.select(legendElem.get(0)).append(\"g\")\r\n    .attr(\"class\", \"axis\")\r\n    .attr(\"transform\", \"translate(\" + posX + \",\" + posY + \")\")\r\n    .call(xAxis);\r\n\r\n  legend.select(\".axis\").select(\".domain\").remove();\r\n}\r\n\r\nfunction drawDiscreteLegendValues(elem, colorOptions, legendWidth) {\r\n  let thresholds = colorOptions.thresholds;\r\n\r\n  let legendElem = $(elem).find('svg');\r\n  let legend = d3.select(legendElem.get(0));\r\n\r\n  if (legendWidth <= 0 || legendElem.get(0).childNodes.length === 0) {\r\n    return;\r\n  }\r\n\r\n  let valuesNumber = thresholds.length;\r\n  let rangeStep  = Math.floor(legendWidth / valuesNumber);\r\n  let valuesRange = d3.range(0, legendWidth, rangeStep);\r\n\r\n\r\n  let legendValueScale = d3.scaleLinear()\r\n    .domain([0, valuesNumber])\r\n    .range([0, legendWidth]);\r\n\r\n  let thresholdValues = [];\r\n  let thresholdTooltips = [];\r\n  for (let i = 0; i < thresholds.length; i++) {\r\n    thresholdValues.push(thresholds[i].value);\r\n    thresholdTooltips.push(thresholds[i].tooltip);\r\n  }\r\n\r\n  let xAxis = d3.axisBottom(legendValueScale)\r\n    .tickValues(d3.range(0, valuesNumber, 1)) //thresholdValues)\r\n    .tickSize(2)\r\n    .tickFormat((t) => {\r\n      let i = Math.floor(t);\r\n      let v = thresholdTooltips[i];\r\n      if (v != undefined) {\r\n        return \"\"+v;\r\n      } else {\r\n        v = thresholdValues[i];\r\n        if (v != undefined) {\r\n          return \"\"+v;\r\n        } else {\r\n          return \"n/a\";\r\n        }\r\n      }\r\n    });\r\n\r\n  let colorRect = legendElem.find(\":first-child\");\r\n  let posY = getSvgElemHeight(legendElem) + 2;\r\n  let posX = getSvgElemX(colorRect) + Math.floor(rangeStep/2);\r\n\r\n  d3.select(legendElem.get(0)).append(\"g\")\r\n    .attr(\"class\", \"axis\")\r\n    .attr(\"transform\", \"translate(\" + posX + \",\" + posY + \")\")\r\n    .call(xAxis);\r\n\r\n  legend.select(\".axis\").select(\".domain\").remove();\r\n}\r\n\r\nfunction drawSimpleColorLegend(elem, colorScale) {\r\n  let legendElem = $(elem).find('svg');\r\n  let legend = d3.select(legendElem.get(0));\r\n  clearLegend(elem);\r\n\r\n  let legendWidth = Math.floor(legendElem.outerWidth());\r\n  let legendHeight = legendElem.attr(\"height\");\r\n\r\n  if (legendWidth) {\r\n    let valuesRange = d3.range(0, legendWidth, LEGEND_STEP_WIDTH);\r\n\r\n    legend.selectAll(\".status-heatmap-color-legend-rect\")\r\n      .data(valuesRange)\r\n      .enter().append(\"rect\")\r\n      .attr(\"x\", d => d)\r\n      .attr(\"y\", 0)\r\n      .attr(\"width\", LEGEND_STEP_WIDTH + 1) // Overlap rectangles to prevent gaps\r\n      .attr(\"height\", legendHeight)\r\n      .attr(\"stroke-width\", 0)\r\n      .attr(\"fill\", d => colorScale(d));\r\n  }\r\n}\r\n\r\nfunction drawSimpleOpacityLegend(elem, options) {\r\n  let legendElem = $(elem).find('svg');\r\n  let legend = d3.select(legendElem.get(0));\r\n  clearLegend(elem);\r\n\r\n  let legendWidth = Math.floor(legendElem.outerWidth());\r\n  let legendHeight = legendElem.attr(\"height\");\r\n\r\n  if (legendWidth) {\r\n    let legendOpacityScale;\r\n    if (options.colorScale === 'linear') {\r\n      legendOpacityScale = d3.scaleLinear()\r\n      .domain([0, legendWidth])\r\n      .range([0, 1]);\r\n    } else if (options.colorScale === 'sqrt') {\r\n      legendOpacityScale = d3.scalePow().exponent(options.exponent)\r\n      .domain([0, legendWidth])\r\n      .range([0, 1]);\r\n    }\r\n\r\n    let valuesRange = d3.range(0, legendWidth, LEGEND_STEP_WIDTH);\r\n\r\n    legend.selectAll(\".status-heatmap-opacity-legend-rect\")\r\n      .data(valuesRange)\r\n      .enter().append(\"rect\")\r\n      .attr(\"x\", d => d)\r\n      .attr(\"y\", 0)\r\n      .attr(\"width\", LEGEND_STEP_WIDTH+1)\r\n      .attr(\"height\", legendHeight)\r\n      .attr(\"stroke-width\", 0)\r\n      .attr(\"fill\", options.cardColor)\r\n      .style(\"opacity\", d => legendOpacityScale(d));\r\n  }\r\n}\r\n\r\n\r\nfunction clearLegend(elem) {\r\n  let legendElem = $(elem).find('svg');\r\n  legendElem.empty();\r\n}\r\n\r\nfunction getColorScale(colorScheme, maxValue, minValue = 0) {\r\n  let colorInterpolator = d3ScaleChromatic[colorScheme.value];\r\n  let colorScaleInverted = colorScheme.invert === 'always' ||\r\n    (colorScheme.invert === 'dark' && !contextSrv.user.lightTheme);\r\n\r\n  let start = colorScaleInverted ? maxValue : minValue;\r\n  let end = colorScaleInverted ? minValue : maxValue;\r\n\r\n  return d3.scaleSequential(colorInterpolator).domain([start, end]);\r\n}\r\n\r\nfunction getOpacityScale(options, maxValue, minValue = 0) {\r\n  let legendOpacityScale;\r\n  if (options.colorScale === 'linear') {\r\n    legendOpacityScale = d3.scaleLinear()\r\n    .domain([minValue, maxValue])\r\n    .range([0, 1]);\r\n  } else if (options.colorScale === 'sqrt') {\r\n    legendOpacityScale = d3.scalePow().exponent(options.exponent)\r\n    .domain([minValue, maxValue])\r\n    .range([0, 1]);\r\n  }\r\n  return legendOpacityScale;\r\n}\r\n\r\nfunction getSvgElemX(elem) {\r\n  let svgElem = elem.get(0);\r\n  if (svgElem && svgElem.x && svgElem.x.baseVal) {\r\n    return svgElem.x.baseVal.value;\r\n  } else {\r\n    return 0;\r\n  }\r\n}\r\n\r\nfunction getSvgElemHeight(elem) {\r\n  let svgElem = elem.get(0);\r\n  if (svgElem && svgElem.height && svgElem.height.baseVal) {\r\n    return svgElem.height.baseVal.value;\r\n  } else {\r\n    return 0;\r\n  }\r\n}\r\n\r\nfunction buildLegendTicks(rangeFrom, rangeTo, maxValue, minValue) {\r\n  let range = rangeTo - rangeFrom;\r\n  let tickStepSize = tickStep(rangeFrom, rangeTo, 3);\r\n  let ticksNum = Math.round(range / tickStepSize);\r\n  let ticks = [];\r\n\r\n  for (let i = 0; i < ticksNum; i++) {\r\n    let current = tickStepSize * i;\r\n    // Add user-defined min and max if it had been set\r\n    if (isValueCloseTo(minValue, current, tickStepSize)) {\r\n      ticks.push(minValue);\r\n      continue;\r\n    } else if (minValue < current) {\r\n      ticks.push(minValue);\r\n    }\r\n    if (isValueCloseTo(maxValue, current, tickStepSize)) {\r\n      ticks.push(maxValue);\r\n      continue;\r\n    } else if (maxValue < current) {\r\n      ticks.push(maxValue);\r\n    }\r\n    ticks.push(tickStepSize * i);\r\n  }\r\n  if (!isValueCloseTo(maxValue, rangeTo, tickStepSize)) {\r\n    ticks.push(maxValue);\r\n  }\r\n  ticks.push(rangeTo);\r\n  ticks = _.sortBy(_.uniq(ticks));\r\n  return ticks;\r\n}\r\n\r\nfunction isValueCloseTo(val, valueTo, step) {\r\n  let diff = Math.abs(val - valueTo);\r\n  return diff < step * 0.3;\r\n}\r\n"]}