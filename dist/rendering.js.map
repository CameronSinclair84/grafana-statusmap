{"version":3,"sources":["../src/rendering.js"],"names":["link","scope","elem","attrs","ctrl","data","cardsData","timeRange","panel","heatmap","$heatmap","find","tooltip","StatusHeatmapTooltip","annotationTooltip","AnnotationTooltip","width","height","yScale","xScale","chartWidth","chartHeight","chartTop","chartBottom","yAxisWidth","xAxisHeight","cardVSpacing","cardHSpacing","cardRound","cardWidth","cardHeight","colorScale","opacityScale","mouseUpHandler","xGridSize","yGridSize","yOffset","selection","active","x1","x2","padding","left","right","top","bottom","margin","dataRangeWidingFactor","DATA_RANGE_WIDING_FACTOR","events","on","render","setElementHeight","row","_","isString","parseInt","replace","legend","show","css","e","getYAxisWidth","axis_text","selectAll","nodes","max_text_width","max","map","text","getBBox","Math","ceil","getXAxisHeight","axis_line","select","empty","axis_line_position","parseFloat","attr","canvas_width","addXAxis","d3","scaleTime","domain","from","to","range","ticks","DEFAULT_X_TICK_SIZE_PX","grafanaTimeFormatter","grafanaTimeFormat","timeFormat","dashboardTimeZone","dashboard","getTimezone","utcFormat","xAxis","axisBottom","tickFormat","tickPadding","X_AXIS_TICK_PADDING","tickSize","posY","posX","append","call","remove","getYScale","step","length","push","i","scaleOrdinal","getYAxisScale","addYAxis","uniq","d","target","isEmpty","yAxisSort","sort","a","b","localeCompare","ignorePunctuation","numeric","yAxisScale","yAxis","axisLeft","tickValues","tickSizeInner","Y_AXIS_TICK_PADDING","wideYAxisRange","min","tickInterval","y_widing","y_min","y_max","floor","tickValueFormatter","decimals","scaledDecimals","format","value","kbn","valueFormats","addHeatmapCanvas","heatmap_elem","cards","CARD_H_SPACING","CARD_V_SPACING","CARD_ROUND","yBucketSize","xBucketSize","style","addHeatmap","maxValue","color","minValue","mode","getColorScale","setOpacityScale","enter","c","id","getCardX","getCardWidth","getCardY","getCardHeight","getCardColor","getCardOpacity","$cards","event","mouseOverBucket","highlightCard","resetCardHighLight","_renderAnnotations","emit","highlightColor","darker","strokeColor","brighter","current_card","originalFillColor","colorScheme","colorSchemes","colorInterpolator","d3ScaleChromatic","colorScaleInverted","invert","contextSrv","user","lightTheme","start","end","scaleSequential","scaleLinear","scalePow","exponent","x","cx","w","cutted_width","MIN_CARD_SIZE","y","ys","h","cardColor","discreteHelper","getBucketColor","values","nullPointMode","getCardStrokeWidth","appEvents","drawSharedCrosshair","pos","clearCrosshair","onMouseDown","offsetX","onMouseUp","$","document","one","unbind","selectionRange","abs","MIN_SELECTION_WIDTH","timeFrom","timeTo","timeSrv","setTime","moment","utc","clearSelection","onMouseLeave","onMouseMove","destroy","limitSelection","drawSelection","emitGraphHoverEvet","drawCrosshair","valueOf","offsetY","pageX","pageY","y1","panelRelY","posX1","posX2","selectionX","selectionWidth","position","graphTooltip","annotations","annoData","time","source","anno","iconColor","join","$ticks","mouseOverAnnotationTick","secPerTick","oneDay","oneYear","tickStep","getScaledDecimals","getFlotTickSize","DEFAULT_Y_TICK_SIZE_PX"],"mappings":"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","file":"rendering.js","sourcesContent":["import _ from 'lodash';\nimport $ from 'jquery';\nimport moment from 'moment';\nimport kbn from 'app/core/utils/kbn';\nimport {appEvents, contextSrv} from 'app/core/core';\nimport {tickStep, getScaledDecimals, getFlotTickSize} from 'app/core/utils/ticks';\nimport d3 from 'd3';\nimport * as d3ScaleChromatic from './libs/d3-scale-chromatic/index';\nimport {StatusHeatmapTooltip} from './tooltip';\nimport {AnnotationTooltip} from './annotations';\n\nlet MIN_CARD_SIZE = 5,\n    CARD_H_SPACING = 2,\n    CARD_V_SPACING = 2,\n    CARD_ROUND = 0,\n    DATA_RANGE_WIDING_FACTOR = 1.2,\n    DEFAULT_X_TICK_SIZE_PX = 100,\n    DEFAULT_Y_TICK_SIZE_PX = 50,\n    X_AXIS_TICK_PADDING = 10,\n    Y_AXIS_TICK_PADDING = 5,\n    MIN_SELECTION_WIDTH = 2;\n\nexport default function link(scope, elem, attrs, ctrl) {\n  let data, cardsData, timeRange, panel, heatmap;\n\n  // $heatmap is JQuery object, but heatmap is D3\n  let $heatmap = elem.find('.status-heatmap-panel');\n  let tooltip = new StatusHeatmapTooltip($heatmap, scope);\n  let annotationTooltip = new AnnotationTooltip($heatmap, scope);\n\n  let width, height,\n      yScale, xScale,\n      chartWidth, chartHeight,\n      chartTop, chartBottom,\n      yAxisWidth, xAxisHeight,\n      cardVSpacing, cardHSpacing, cardRound,\n      cardWidth, cardHeight,\n      colorScale, opacityScale,\n      mouseUpHandler,\n      xGridSize, yGridSize;\n\n  let yOffset = 0;\n\n  let selection = {\n    active: false,\n    x1: -1,\n    x2: -1\n  };\n\n  let padding = {left: 0, right: 0, top: 0, bottom: 0},\n      margin = {left: 25, right: 15, top: 10, bottom: 20},\n      dataRangeWidingFactor = DATA_RANGE_WIDING_FACTOR;\n\n  ctrl.events.on('render', () => {\n    render();\n  });\n\n  function setElementHeight() {\n    try {\n      var height = ctrl.height || panel.height || ctrl.row.height;\n      if (_.isString(height)) {\n        height = parseInt(height.replace('px', ''), 10);\n      }\n\n      height -= panel.legend.show ? 32 : 10; // bottom padding and space for legend. Change margin in .status-heatmap-color-legend !\n\n      $heatmap.css('height', height + 'px');\n\n      return true;\n    } catch (e) { // IE throws errors sometimes\n      return false;\n    }\n  }\n\n  function getYAxisWidth(elem) {\n    let axis_text = elem.selectAll(\".axis-y text\").nodes();\n    let max_text_width = _.max(_.map(axis_text, text => {\n      // Use SVG getBBox method\n      return text.getBBox().width;\n    }));\n\n    return Math.ceil(max_text_width);\n  }\n\n  function getXAxisHeight(elem) {\n    let axis_line = elem.select(\".axis-x line\");\n    if (!axis_line.empty()) {\n      let axis_line_position = parseFloat(elem.select(\".axis-x line\").attr(\"y2\"));\n      let canvas_width = parseFloat(elem.attr(\"height\"));\n      return canvas_width - axis_line_position;\n    } else {\n      // Default height\n      return 30;\n    }\n  }\n\n  function addXAxis() {\n    // Scale timestamps to cards centers\n    scope.xScale = xScale = d3.scaleTime()\n      .domain([timeRange.from, timeRange.to])\n      .range([xGridSize/2, chartWidth-xGridSize/2]);\n\n    let ticks = chartWidth / DEFAULT_X_TICK_SIZE_PX;\n    let grafanaTimeFormatter = grafanaTimeFormat(ticks, timeRange.from, timeRange.to);\n    let timeFormat;\n    let dashboardTimeZone = ctrl.dashboard.getTimezone();\n    if (dashboardTimeZone === 'utc') {\n      timeFormat = d3.utcFormat(grafanaTimeFormatter);\n    } else {\n      timeFormat = d3.timeFormat(grafanaTimeFormatter);\n    }\n\n    let xAxis = d3.axisBottom(xScale)\n      .ticks(ticks)\n      .tickFormat(timeFormat)\n      .tickPadding(X_AXIS_TICK_PADDING)\n      .tickSize(chartHeight);\n\n    let posY = chartTop;\n    let posX = yAxisWidth;\n\n    heatmap.append(\"g\")\n      .attr(\"class\", \"axis axis-x\")\n      .attr(\"transform\", \"translate(\" + posX + \",\" + posY + \")\")\n      .call(xAxis);\n\n    // Remove horizontal line in the top of axis labels (called domain in d3)\n    heatmap.select(\".axis-x\").select(\".domain\").remove();\n  }\n\n  // divide chart height by ticks for cards drawing\n  function getYScale(ticks) {\n    let range = [];\n    let step = chartHeight / ticks.length;\n    // svg has y=0 on the top, so top card should have a minimal value in range\n    range.push(step);\n    for (let i = 1; i < ticks.length; i++) {\n      range.push(step * (i+1));\n    }\n    return d3.scaleOrdinal()\n      .domain(ticks)\n      .range(range);\n  }\n\n  // divide chart height by ticks with offset for ticks drawing\n  function getYAxisScale(ticks) {\n    let range = [];\n    let step = chartHeight / ticks.length;\n    // svg has y=0 on the top, so top tick should have a minimal value in range\n    range.push(yOffset);\n    for (let i = 1; i < ticks.length; i++) {\n      range.push(step * i + yOffset);\n    }\n    return d3.scaleOrdinal()\n      .domain(ticks)\n      .range(range);\n  }\n\n  function addYAxis() {\n    let ticks = _.uniq(_.map(data, d => d.target));\n\n    // Set default Y min and max if no data\n    if (_.isEmpty(data)) {\n      ticks = [''];\n    }\n\n    if (panel.yAxisSort == 'a → z') {\n      ticks.sort((a, b) => a.localeCompare(b, 'en', {ignorePunctuation: false, numeric: true}));\n    } else if (panel.yAxisSort == 'z → a') {\n      ticks.sort((b, a) => a.localeCompare(b, 'en', {ignorePunctuation: false, numeric: true}));\n    }\n\n    let yAxisScale = getYAxisScale(ticks);\n    scope.yScale = yScale = getYScale(ticks);\n\n    let yAxis = d3.axisLeft(yAxisScale)\n      .tickValues(ticks)\n      .tickSizeInner(0 - width)\n      .tickPadding(Y_AXIS_TICK_PADDING);\n\n    heatmap.append(\"g\")\n      .attr(\"class\", \"axis axis-y\")\n      .call(yAxis);\n\n    // Calculate Y axis width first, then move axis into visible area\n    let posY = margin.top;\n    let posX = getYAxisWidth(heatmap) + Y_AXIS_TICK_PADDING;\n    heatmap.select(\".axis-y\").attr(\"transform\", \"translate(\" + posX + \",\" + posY + \")\");\n\n    // Remove vertical line in the right of axis labels (called domain in d3)\n    heatmap.select(\".axis-y\").select(\".domain\").remove();\n    heatmap.select(\".axis-y\").selectAll(\".tick line\").remove();\n  }\n\n  // Wide Y values range and adjust to bucket size\n  function wideYAxisRange(min, max, tickInterval) {\n    let y_widing = (max * (dataRangeWidingFactor - 1) - min * (dataRangeWidingFactor - 1)) / 2;\n    let y_min, y_max;\n\n    if (tickInterval === 0) {\n      y_max = max * dataRangeWidingFactor;\n      y_min = min - min * (dataRangeWidingFactor - 1);\n      tickInterval = (y_max - y_min) / 2;\n    } else {\n      y_max = Math.ceil((max + y_widing) / tickInterval) * tickInterval;\n      y_min = Math.floor((min - y_widing) / tickInterval) * tickInterval;\n    }\n\n    // Don't wide axis below 0 if all values are positive\n    if (min >= 0 && y_min < 0) {\n      y_min = 0;\n    }\n\n    return {y_min, y_max};\n  }\n\n  function tickValueFormatter(decimals, scaledDecimals = null) {\n    let format = panel.yAxis.format;\n    return function(value) {\n      return kbn.valueFormats[format](value, decimals, scaledDecimals);\n    };\n  }\n\n  // Create svg element, add axes and\n  // calculate sizes for cards drawing\n  function addHeatmapCanvas() {\n    let heatmap_elem = $heatmap[0];\n\n    width = Math.floor($heatmap.width()) - padding.right;\n    height = Math.floor($heatmap.height()) - padding.bottom;\n\n    if (heatmap) {\n      heatmap.remove();\n    }\n\n    heatmap = d3.select(heatmap_elem)\n      .append(\"svg\")\n      .attr(\"width\", width)\n      .attr(\"height\", height);\n\n    chartHeight = height - margin.top - margin.bottom;\n    chartTop = margin.top;\n    chartBottom = chartTop + chartHeight;\n\n    cardHSpacing = panel.cards.cardHSpacing !== null ? panel.cards.cardHSpacing : CARD_H_SPACING;\n    cardVSpacing = panel.cards.cardVSpacing !== null ? panel.cards.cardVSpacing : CARD_V_SPACING;\n    cardRound = panel.cards.cardRound !== null ? panel.cards.cardRound : CARD_ROUND;\n\n    // calculate yOffset for YAxis\n    yGridSize = Math.floor(chartHeight / cardsData.yBucketSize);\n    cardHeight = yGridSize ? yGridSize - cardVSpacing : 0;\n    yOffset = cardHeight / 2;\n\n    addYAxis();\n\n    yAxisWidth = getYAxisWidth(heatmap) + Y_AXIS_TICK_PADDING;\n    chartWidth = width - yAxisWidth - margin.right;\n\n    // TODO allow per-y cardWidth!\n    // we need to fill chartWidth with xBucketSize cards.\n    xGridSize = chartWidth / (cardsData.xBucketSize+1);\n    cardWidth = xGridSize - cardHSpacing;\n\n    addXAxis();\n    xAxisHeight = getXAxisHeight(heatmap);\n\n    if (!panel.yAxis.show) {\n      heatmap.select(\".axis-y\").selectAll(\"line\").style(\"opacity\", 0);\n    }\n\n    if (!panel.xAxis.show) {\n      heatmap.select(\".axis-x\").selectAll(\"line\").style(\"opacity\", 0);\n    }\n  }\n\n  function addHeatmap() {\n    addHeatmapCanvas();\n\n    let maxValue = panel.color.max || cardsData.maxValue;\n    let minValue = panel.color.min || cardsData.minValue;\n\n    if (panel.color.mode !== 'discrete') {\n      colorScale = getColorScale(maxValue, minValue);\n    }\n    setOpacityScale(maxValue);\n\n    let cards = heatmap.selectAll(\".status-heatmap-card\").data(cardsData.cards);\n    cards.append(\"title\");\n    cards = cards.enter().append(\"rect\")\n    .attr(\"cardId\", c => c.id)\n    .attr(\"x\", getCardX)\n    .attr(\"width\", getCardWidth)\n    .attr(\"y\", getCardY)\n    .attr(\"height\", getCardHeight)\n    .attr(\"rx\", cardRound)\n    .attr(\"ry\", cardRound)\n    .attr(\"class\", \"bordered status-heatmap-card\")\n    .style(\"fill\", getCardColor)\n    .style(\"stroke\", getCardColor)\n    .style(\"stroke-width\", 0)\n    //.style(\"stroke-width\", getCardStrokeWidth)\n    //.style(\"stroke-dasharray\", \"3,3\")\n    .style(\"opacity\", getCardOpacity);\n\n    let $cards = $heatmap.find(\".status-heatmap-card\");\n    $cards.on(\"mouseenter\", (event) => {\n      tooltip.mouseOverBucket = true;\n      highlightCard(event);\n    })\n    .on(\"mouseleave\", (event) => {\n      tooltip.mouseOverBucket = false;\n      resetCardHighLight(event);\n    });\n\n    _renderAnnotations();\n\n    ctrl.events.emit('render-complete', {\n      \"chartWidth\": chartWidth\n    });\n  }\n\n  function highlightCard(event) {\n    let color = d3.select(event.target).style(\"fill\");\n    let highlightColor = d3.color(color).darker(2);\n    let strokeColor = d3.color(color).brighter(4);\n    let current_card = d3.select(event.target);\n    tooltip.originalFillColor = color;\n    current_card.style(\"fill\", highlightColor)\n    .style(\"stroke\", strokeColor)\n    .style(\"stroke-width\", 1);\n  }\n\n  function resetCardHighLight(event) {\n    d3\n      .select(event.target)\n      .style(\"fill\", tooltip.originalFillColor)\n      .style(\"stroke\", tooltip.originalFillColor)\n      .style(\"stroke-width\", 0);\n  }\n\n  function getColorScale(maxValue, minValue = 0) {\n    let colorScheme = _.find(ctrl.colorSchemes, {value: panel.color.colorScheme});\n    let colorInterpolator = d3ScaleChromatic[colorScheme.value];\n    let colorScaleInverted = colorScheme.invert === 'always' ||\n      (colorScheme.invert === 'dark' && !contextSrv.user.lightTheme);\n\n    if (maxValue == minValue)\n      maxValue = minValue + 1;\n\n    let start = colorScaleInverted ? maxValue : minValue;\n    let end = colorScaleInverted ? minValue : maxValue;\n\n    return d3.scaleSequential(colorInterpolator).domain([start, end]);\n  }\n\n  function setOpacityScale(maxValue) {\n    if (panel.color.colorScale === 'linear') {\n      opacityScale = d3.scaleLinear()\n      .domain([0, maxValue])\n      .range([0, 1]);\n    } else if (panel.color.colorScale === 'sqrt') {\n      opacityScale = d3.scalePow().exponent(panel.color.exponent)\n      .domain([0, maxValue])\n      .range([0, 1]);\n    }\n  }\n\n  function getCardX(d) {\n    let x;\n    // cx is the center of the card. Card should be placed to the left.\n    let cx = xScale(d.x);\n\n    if (cx - cardWidth/2 < 0) {\n      x = yAxisWidth + cardHSpacing/2;\n    } else {\n      x = yAxisWidth + cx - cardWidth/2;\n    }\n\n    return x;\n  }\n\n  // xScale returns card center. Adjust cardWidth in case of overlaping.\n  function getCardWidth(d) {\n    let w;\n    let cx = xScale(d.x);\n\n    if (cx < cardWidth/2) {\n      // Center should not exceed half of card.\n      // Cut card to the left to prevent overlay of y axis.\n      let cutted_width = (cx - cardHSpacing/2) + cardWidth/2;\n      w = cutted_width > 0 ? cutted_width : 0;\n    } else if (chartWidth - cx < cardWidth/2) {\n      // Cut card to the right to prevent overlay of right graph edge.\n      w = cardWidth/2 + (chartWidth - cx - cardHSpacing/2);\n    } else {\n      w = cardWidth;\n    }\n\n    // Card width should be MIN_CARD_SIZE at least\n    w = Math.max(w, MIN_CARD_SIZE);\n\n    if (cardHSpacing == 0) {\n      w = w+1;\n    }\n\n    return w;\n  }\n\n  function getCardY(d) {\n    return yScale(d.y) + chartTop - cardHeight - cardVSpacing/2;\n  }\n\n  function getCardHeight(d) {\n    let ys = yScale(d.y);\n    let y = ys + chartTop - cardHeight - cardVSpacing/2;\n    let h = cardHeight;\n\n    // Cut card height to prevent overlay\n    if (y < chartTop) {\n      h = ys - cardVSpacing/2;\n    } else if (ys > chartBottom) {\n      h = chartBottom - y;\n    } else if (y + cardHeight > chartBottom) {\n      h = chartBottom - y;\n    }\n\n    // Height can't be more than chart height\n    h = Math.min(h, chartHeight);\n    // Card height should be MIN_CARD_SIZE at least\n    h = Math.max(h, MIN_CARD_SIZE);\n\n    if (cardVSpacing == 0) {\n      h = h+1\n    }\n\n    return h;\n  }\n\n  function getCardColor(d) {\n    if (panel.color.mode === 'opacity') {\n      return panel.color.cardColor;\n    } else if (panel.color.mode === 'spectrum') {\n      return colorScale(d.value);\n    } else if (panel.color.mode === 'discrete') {\n      return ctrl.discreteHelper.getBucketColor(d.values);\n    }\n  }\n\n  function getCardOpacity(d) {\n    if (panel.nullPointMode === 'as empty' && d.value == null ) {\n      return 0;\n    }\n    if (panel.color.mode === 'opacity') {\n      return opacityScale(d.value);\n    } else {\n      return 1;\n    }\n  }\n\n  function getCardStrokeWidth(d) {\n    if (panel.color.mode === 'discrete') {\n      return '1';\n    }\n    return '0';\n  }\n\n  /////////////////////////////\n  // Selection and crosshair //\n  /////////////////////////////\n\n  // Shared crosshair and tooltip\n  appEvents.on('graph-hover', event => {\n    drawSharedCrosshair(event.pos);\n  }, scope);\n\n  appEvents.on('graph-hover-clear', () => {\n    clearCrosshair();\n  }, scope);\n\n  function onMouseDown(event) {\n    selection.active = true;\n    selection.x1 = event.offsetX;\n\n    mouseUpHandler = function() {\n      onMouseUp();\n    };\n\n    $(document).one(\"mouseup\", mouseUpHandler);\n  }\n\n  function onMouseUp() {\n    $(document).unbind(\"mouseup\", mouseUpHandler);\n    mouseUpHandler = null;\n    selection.active = false;\n\n    let selectionRange = Math.abs(selection.x2 - selection.x1);\n    if (selection.x2 >= 0 && selectionRange > MIN_SELECTION_WIDTH) {\n      let timeFrom = xScale.invert(Math.min(selection.x1, selection.x2) - yAxisWidth - xGridSize/2);\n      let timeTo = xScale.invert(Math.max(selection.x1, selection.x2) - yAxisWidth - xGridSize/2);\n\n      ctrl.timeSrv.setTime({\n        from: moment.utc(timeFrom),\n        to: moment.utc(timeTo)\n      });\n    }\n\n    clearSelection();\n  }\n\n  function onMouseLeave() {\n    appEvents.emit('graph-hover-clear');\n    clearCrosshair();\n    //annotationTooltip.destroy();\n  }\n\n  function onMouseMove(event) {\n    if (!heatmap) { return; }\n\n    if (selection.active) {\n      // Clear crosshair and tooltip\n      clearCrosshair();\n      tooltip.destroy();\n      annotationTooltip.destroy();\n\n      selection.x2 = limitSelection(event.offsetX);\n      drawSelection(selection.x1, selection.x2);\n    } else {\n      emitGraphHoverEvet(event);\n      drawCrosshair(event.offsetX);\n      tooltip.show(event); //, data);\n      annotationTooltip.show(event);\n    }\n  }\n\n  function emitGraphHoverEvet(event) {\n    let x = xScale.invert(event.offsetX - yAxisWidth - xGridSize/2).valueOf();\n    let y = yScale(event.offsetY);\n    let pos = {\n      pageX: event.pageX,\n      pageY: event.pageY,\n      x: x, x1: x,\n      y: y, y1: y,\n      panelRelY: null\n    };\n\n    // Set minimum offset to prevent showing legend from another panel\n    pos.panelRelY = Math.max(event.offsetY / height, 0.001);\n\n    // broadcast to other graph panels that we are hovering\n    appEvents.emit('graph-hover', {pos: pos, panel: panel});\n  }\n\n  function limitSelection(x2) {\n    x2 = Math.max(x2, yAxisWidth);\n    x2 = Math.min(x2, chartWidth + yAxisWidth);\n    return x2;\n  }\n\n  function drawSelection(posX1, posX2) {\n    if (heatmap) {\n      heatmap.selectAll(\".status-heatmap-selection\").remove();\n      let selectionX = Math.min(posX1, posX2);\n      let selectionWidth = Math.abs(posX1 - posX2);\n\n      if (selectionWidth > MIN_SELECTION_WIDTH) {\n        heatmap.append(\"rect\")\n        .attr(\"class\", \"status-heatmap-selection\")\n        .attr(\"x\", selectionX)\n        .attr(\"width\", selectionWidth)\n        .attr(\"y\", chartTop)\n        .attr(\"height\", chartHeight);\n      }\n    }\n  }\n\n  function clearSelection() {\n    selection.x1 = -1;\n    selection.x2 = -1;\n\n    if (heatmap) {\n      heatmap.selectAll(\".status-heatmap-selection\").remove();\n    }\n  }\n\n  function drawCrosshair(position) {\n    if (heatmap) {\n      heatmap.selectAll(\".status-heatmap-crosshair\").remove();\n\n      let posX = position;\n      posX = Math.max(posX, yAxisWidth);\n      posX = Math.min(posX, chartWidth + yAxisWidth);\n\n      heatmap.append(\"g\")\n      .attr(\"class\", \"status-heatmap-crosshair\")\n      .attr(\"transform\", \"translate(\" + posX + \",0)\")\n      .append(\"line\")\n      .attr(\"x1\", 1)\n      .attr(\"y1\", chartTop)\n      .attr(\"x2\", 1)\n      .attr(\"y2\", chartBottom)\n      .attr(\"stroke-width\", 1);\n    }\n  }\n\n  // map time to X\n  function drawSharedCrosshair(pos) {\n    if (heatmap && ctrl.dashboard.graphTooltip !== 0) {\n      let posX = xScale(pos.x) + yAxisWidth;\n      drawCrosshair(posX);\n    }\n  }\n\n  function clearCrosshair() {\n    if (heatmap) {\n      heatmap.selectAll(\".status-heatmap-crosshair\").remove();\n    }\n  }\n\n  function render() {\n    data = ctrl.data;\n    panel = ctrl.panel;\n    timeRange = ctrl.range;\n    cardsData = ctrl.cardsData;\n\n    if (!data || !cardsData || !setElementHeight()) {\n      return;\n    }\n\n    // Draw default axes and return if no data\n    if (_.isEmpty(cardsData.cards)) {\n      addHeatmapCanvas();\n      return;\n    }\n\n    addHeatmap();\n    scope.yAxisWidth = yAxisWidth;\n    scope.xAxisHeight = xAxisHeight;\n    scope.chartHeight = chartHeight;\n    scope.chartWidth = chartWidth;\n    scope.chartTop = chartTop;\n  }\n\n  // Register selection listeners\n  $heatmap.on(\"mousedown\", onMouseDown);\n  $heatmap.on(\"mousemove\", onMouseMove);\n  $heatmap.on(\"mouseleave\", onMouseLeave);\n\n  function _renderAnnotations() {\n    if (!ctrl.annotations || ctrl.annotations.length == 0) {\n      return;\n    }\n  \n    if (!heatmap) {\n      return;\n    }\n\n    let annoData = _.map(ctrl.annotations, (d,i) => ({\"x\": Math.floor(yAxisWidth + xScale(d.time)), \"id\":i, \"anno\": d.source}));\n\n\n    let anno = heatmap\n      .append(\"g\")\n      .attr(\"class\", \"statusmap-annotations\")\n      .attr(\"transform\", \"translate(0.5,0)\")\n      .selectAll(\".statusmap-annotations\")\n      .data(annoData)\n      .enter().append(\"g\")\n      ;\n    anno.append(\"line\")\n      //.attr(\"class\", \"statusmap-annotation-tick\")\n      .attr(\"x1\", d => d.x)\n      .attr(\"y1\", chartTop)\n      .attr(\"x2\", d => d.x)\n      .attr(\"y2\", chartBottom)\n      .style(\"stroke\", d => d.anno.iconColor)\n      .style(\"stroke-width\", 1)\n      .style(\"stroke-dasharray\", \"3,3\")\n    ;\n    anno.append(\"polygon\")\n      .attr(\"points\", d => [[d.x, chartBottom+1], [d.x-5, chartBottom+6], [d.x+5, chartBottom+6]].join(\" \"))\n      .style(\"stroke-width\", 0)\n      .style(\"fill\", d => d.anno.iconColor)\n    ;\n    // Polygons didn't fire mouseevents\n    anno.append(\"rect\") \n      .attr(\"x\", d => d.x-5)\n      .attr(\"width\", 10)\n      .attr(\"y\", chartBottom+1)\n      .attr(\"height\", 5)\n      .attr(\"class\", \"statusmap-annotation-tick\")\n      .attr(\"annoId\", d => d.id)\n      .style(\"opacity\", 0)\n    ;\n\n    let $ticks = $heatmap.find(\".statusmap-annotation-tick\");\n    $ticks.on(\"mouseenter\", (event) => {\n      annotationTooltip.mouseOverAnnotationTick = true;\n    })\n    .on(\"mouseleave\", (event) => {\n      annotationTooltip.mouseOverAnnotationTick = false;\n    });\n    \n  }\n}\n\nfunction grafanaTimeFormat(ticks, min, max) {\n  if (min && max && ticks) {\n    let range = max - min;\n    let secPerTick = (range/ticks) / 1000;\n    let oneDay = 86400000;\n    let oneYear = 31536000000;\n\n    if (secPerTick <= 45) {\n      return \"%H:%M:%S\";\n    }\n    if (secPerTick <= 7200 || range <= oneDay) {\n      return \"%H:%M\";\n    }\n    if (secPerTick <= 80000) {\n      return \"%m/%d %H:%M\";\n    }\n    if (secPerTick <= 2419200 || range <= oneYear) {\n      return \"%m/%d\";\n    }\n    return \"%Y-%m\";\n  }\n\n  return \"%H:%M\";\n}\n"]}